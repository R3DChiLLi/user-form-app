name: testing
on:
  push: 
    branches:
      - main
jobs:
  Rollback-Frontend:
    runs-on: self-hosted
    needs: Deploy-Frontend
    if: failure()
    steps:
      - name: Find Commit with Release SHA
        id: find-commit
        run: |
          RELEASE_SHA=$(curl -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/${{ github.repository }}/actions/artifacts \
            | jq -r '.artifacts[] | select(.name=="release-sha") | .workflow_run.head_sha')
          echo "RELEASE_SHA=$RELEASE_SHA" >> $GITHUB_ENV